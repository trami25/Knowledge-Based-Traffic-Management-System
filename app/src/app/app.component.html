<div class="p-4">
  <div class="topbar">
    <h1 class="m-0">Traffic UI</h1>
    <p-toggleButton
      [onIcon]="'pi pi-moon'"
      [offIcon]="'pi pi-sun'"
      [onLabel]="'Dark'"
      [offLabel]="'Light'"
      [(ngModel)]="darkModeToggle"
      (onChange)="toggleDarkMode()"
    ></p-toggleButton>
  </div>
  <div class="layout-cols">
    <div class="left-pane">
      <p-card header="Model Input" subheader="Select a model and provide inputs">
        <div class="flex flex-column gap-3" [formGroup]="form">
          <div class="flex flex-column gap-2">
            <label for="model">Model</label>
            <p-dropdown
              inputId="model"
              [options]="modelOptions"
              optionLabel="label"
              optionValue="value"
              placeholder="Select model"
              formControlName="model"
            ></p-dropdown>
          </div>

          <!-- Dynamic Components -->
          <ng-container [ngSwitch]="form.value.model">
            <app-accident
              *ngSwitchCase="'accident'"
              (formSubmit)="onDynamicFormSubmit($event)"
              (formReset)="onDynamicFormReset()"
            ></app-accident>
            
            <app-vehicle
              *ngSwitchCase="'vehicle'"
              (formSubmit)="onDynamicFormSubmit($event)"
              (formReset)="onDynamicFormReset()"
            ></app-vehicle>
            
            <app-weather
              *ngSwitchCase="'weather'"
              (formSubmit)="onDynamicFormSubmit($event)"
              (formReset)="onDynamicFormReset()"
            ></app-weather>
            
            <app-traffic-density
              *ngSwitchCase="'trafficDensity'"
              (formSubmit)="onDynamicFormSubmit($event)"
              (formReset)="onDynamicFormReset()"
            ></app-traffic-density>
            
            <app-emergency-vehicle
              *ngSwitchCase="'emergencyVehicle'"
              (formSubmit)="onDynamicFormSubmit($event)"
              (formReset)="onDynamicFormReset()"
            ></app-emergency-vehicle>
            
            <app-cause-fact
              *ngSwitchCase="'causeFact'"
              (formSubmit)="onDynamicFormSubmit($event)"
              (formReset)="onDynamicFormReset()"
            ></app-cause-fact>
            
            <app-time-of-day
              *ngSwitchCase="'timeOfDay'"
              (formSubmit)="onDynamicFormSubmit($event)"
              (formReset)="onDynamicFormReset()"
            ></app-time-of-day>
            
            <div *ngSwitchDefault class="p-3 text-center text-color-secondary">
              Please select a model to see the input form.
            </div>
          </ng-container>
        </div>
      </p-card>
    </div>

    <div class="right-pane">
      <p-card header="Output Log" subheader="Recent responses (newest first)">
        <div class="log-scroll">
          <ng-container *ngIf="logs()?.length; else empty">
            <div class="log-entry" *ngFor="let e of logs()">
              <div class="log-meta">
                <span class="pi pi-clock mr-2"></span>
                <strong>{{ e.timestamp }}</strong>
                <span class="ml-2">â€¢</span>
                <span class="ml-2">{{ e.model }}</span>
              </div>
              <pre class="m-0">{{ e | json }}</pre>
              <p-divider></p-divider>
            </div>
          </ng-container>
          <ng-template #empty>
            <div class="text-color-secondary">No entries yet. Submit the form to see results here.</div>
          </ng-template>
        </div>
      </p-card>
    </div>
  </div>
</div>
